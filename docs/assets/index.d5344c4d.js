var M=Object.defineProperty,y=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var C=(a,e,t)=>e in a?M(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,E=(a,e)=>{for(var t in e||(e={}))V.call(e,t)&&C(a,t,e[t]);if(D)for(var t of D(e))k.call(e,t)&&C(a,t,e[t]);return a},x=(a,e)=>y(a,L(e));var c=(a,e,t)=>(C(a,typeof e!="symbol"?e+"":e,t),t);import{j as n,r as l,m as O,a as f,I as S,B as P,b as I,o as d,c as R,d as g,M as T,P as K,U as N,T as $,e as j,R as A,f as U}from"./vendor.60e82da3.js";const z=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}};z();const G=({filterList:a,onFilter:e})=>n("div",{children:"QueryFilter..."}),J=({folderName:a,onSave:e})=>{const[t,o]=l.exports.useState();l.exports.useEffect(()=>{o(a)},[a]);const s=l.exports.useCallback(()=>{if(!t){O.warn("\u8BF7\u8F93\u5165\u5408\u6CD5\u7684\u8DEF\u5F84");return}e(t)},[t]);return f("div",{children:[n("p",{children:"\u6B64\u5904\u8BBE\u7F6E\u6587\u4EF6\u76EE\u5F55\u8DEF\u5F84\uFF08\u4F7F\u5F97\u56FE\u7247\u8F7D\u5165\u6B63\u786E\uFF09"}),f(S.Group,{compact:!0,children:[n(S,{style:{width:"calc(100% - 200px)"},value:t,onChange:r=>o(r.target.value)}),n(P,{type:"primary",onClick:s,children:"\u4FDD\u5B58"})]})]})};class Q{constructor(){c(this,"loading",!1);c(this,"csvData",[]);c(this,"folderPath","");c(this,"filterList",[]);c(this,"mapperList",[]);c(this,"headers",[]);c(this,"visibleData",[]);c(this,"rowIndex",1);c(this,"rowsPerPage",20);c(this,"total",0);I(this,{loading:d,csvData:d,folderPath:d,filterList:d,mapperList:d,mapperDict:R,headers:d,visibleData:d,rowIndex:d,rowsPerPage:d,total:d,refreshVisibleData:g,updateCSVParseRes:g,updateFolderPath:g,updateFilterList:g,updateMapperList:g,updateViewData:g})}get mapperDict(){return this.mapperList.reduce((e,t)=>(e[t.key]=t.value,e),{})}refreshVisibleData(){this.total=this.csvData.length;const e=(this.rowIndex-1)*this.rowsPerPage,t=e+this.rowsPerPage;console.log("start-end-csvlength",e,t,this.csvData.length),this.visibleData=this.csvData.slice(e,t)}updateCSVParseRes(e){this.headers=e.headers,this.csvData=e.data,this.refreshVisibleData()}updateFolderPath(e){this.folderPath=e}updateFilterList(e){this.filterList=e}updateMapperList(e){this.mapperList=e}updateViewData(e){var t,o;this.rowsPerPage=(t=e.pageSize)!=null?t:this.rowsPerPage,this.rowIndex=(o=e.current)!=null?o:this.rowIndex,this.refreshVisibleData()}}const u=new Q,_=({visible:a,mapperConfigList:e,onOk:t,onCancel:o})=>{const[s,r]=l.exports.useState([]);l.exports.useEffect(()=>{r(e)},[a,e]);const i=l.exports.useCallback(()=>{console.log("onModalOk"),t(s)},[t,s]);return f(T,{visible:a,onOk:i,onCancel:o,children:[n("div",{children:"This is Modal Content..."}),n("code",{children:n("pre",{children:JSON.stringify(s,null,2)})})]})},q=({mapperConfigList:a,onSave:e})=>{const[t,o]=l.exports.useState(!1),s=l.exports.useCallback(i=>{o(!1),e(i)},[]),r=l.exports.useMemo(()=>a!=null?a:[],[a]);return f("div",{children:[n("p",{children:"\u6B64\u5904\u8BBE\u7F6E\u6620\u5C04\u89C4\u5219"}),"\u70B9\u51FB(",n(P,{onClick:()=>o(!0),children:"\u8BBE\u7F6E"}),")\u6309\u94AE\u8BBE\u7F6E\u6620\u5C04\u89C4\u5219",n(_,{visible:t,mapperConfigList:r,onOk:s,onCancel:()=>o(!1)})]})},B="uuid",Y=a=>{let e=[];const t=[];return a.forEach((o,s)=>{if(s===0)e=o;else{const r={[B]:`${new Date().getMilliseconds()}-${s}`};o.forEach((i,h)=>{const b=i,p=e[h];r[p]=b}),t.push(r)}}),{data:t,headers:e}},H=({onRead:a})=>{const e=l.exports.useCallback(t=>(console.log("info",t),new Promise((o,s)=>{K.parse(t,{complete(r,i){console.log("completed",r,i);const h=Y(r.data);console.log("transform completed",h),a(h),o("OK")},error(r,i){console.log("error",r,i),s("Error")}})})),[a]);return f("div",{children:[n("p",{children:"\u6B64\u5904\u4E0A\u4F20CSV\u8FDB\u884C\u8BFB\u53D6"}),n(N,{accept:"text/csv",action:e,children:n(P,{children:"\u70B9\u51FB\u4E0A\u4F20CSV"})})]})},W=({data:a,mapperDict:e,headers:t,folderPath:o,rowsPerPage:s,total:r,onChange:i})=>{const h=l.exports.useMemo(()=>t.map(p=>{var m;const F={dataIndex:p,title:(m=e[p])!=null?m:p};return p==="hud_icon"?x(E({},F),{render:v=>{const w=`${o}${v}`;return n("img",{src:w,alt:v})}}):F}),[e,t,o]),b=l.exports.useCallback((p,F,m)=>{console.log("onTableChange",p,F,m),i(p)},[i]);return n("div",{children:n($,{rowKey:B,dataSource:a,columns:h,onChange:b,pagination:{total:r,pageSize:s}})})},X=()=>{const a=l.exports.useCallback(r=>{console.log("onFilter",r)},[]),e=l.exports.useCallback(r=>{u.updateFolderPath(r)},[]),t=l.exports.useCallback(r=>{u.updateMapperList(r)},[]),o=l.exports.useCallback(r=>{u.updateCSVParseRes(r)},[]),s=l.exports.useCallback(r=>{u.updateViewData(r)},[]);return f("div",{children:[n(q,{mapperConfigList:u.mapperList,onSave:t}),n(J,{folderName:u.folderPath,onSave:e}),n(H,{onRead:o}),n(G,{filterList:u.filterList,onFilter:a}),n(W,{data:u.visibleData,folderPath:u.folderPath,headers:u.headers,total:u.total,mapperDict:u.mapperDict,rowsPerPage:u.rowsPerPage,onChange:s})]})};var Z=j(X);A.render(n(U.StrictMode,{children:n(Z,{})}),document.getElementById("root"));
